version: '3.8'

services:
  # TigerEx Core Services
  tiger-academy-service:
    build: ./backend/tiger-academy-service
    container_name: tiger-academy-service
    ports:
      - "5001:5001"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-academy-secret-key
      - PORT=5001
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-admin-service:
    build: ./backend/tiger-admin-service
    container_name: tiger-admin-service
    ports:
      - "5002:5002"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-admin-secret-key
      - PORT=5002
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-verify-service:
    build: ./backend/tiger-verify-service
    container_name: tiger-verify-service
    ports:
      - "5003:5003"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-verify-secret-key
      - PORT=5003
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-wealth-service:
    build: ./backend/tiger-wealth-service
    container_name: tiger-wealth-service
    ports:
      - "5004:5004"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-wealth-secret-key
      - PORT=5004
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-unified-exchange-service:
    build: ./backend/tiger-unified-exchange-service
    container_name: tiger-unified-exchange-service
    ports:
      - "5005:5005"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-unified-exchange-secret-key
      - PORT=5005
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-user-service:
    build: ./backend/tiger-user-service
    container_name: tiger-user-service
    ports:
      - "5006:5006"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-user-secret-key
      - PORT=5006
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-trading-service:
    build: ./backend/tiger-trading-service
    container_name: tiger-trading-service
    ports:
      - "5007:5007"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-trading-secret-key
      - PORT=5007
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-wallet-service:
    build: ./backend/tiger-wallet-service
    container_name: tiger-wallet-service
    ports:
      - "5008:5008"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-wallet-secret-key
      - PORT=5008
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-staking-service:
    build: ./backend/tiger-staking-service
    container_name: tiger-staking-service
    ports:
      - "5009:5009"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-staking-secret-key
      - PORT=5009
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-nft-service:
    build: ./backend/tiger-nft-service
    container_name: tiger-nft-service
    ports:
      - "5010:5010"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-nft-secret-key
      - PORT=5010
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-pay-service:
    build: ./backend/tiger-pay-service
    container_name: tiger-pay-service
    ports:
      - "5011:5011"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-pay-secret-key
      - PORT=5011
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-card-service:
    build: ./backend/tiger-card-service
    container_name: tiger-card-service
    ports:
      - "5012:5012"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-card-secret-key
      - PORT=5012
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  tiger-trading-bots-service:
    build: ./backend/tiger-trading-bots-service
    container_name: tiger-trading-bots-service
    ports:
      - "5013:5013"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/tigerex
      - JWT_SECRET_KEY=tiger-trading-bots-secret-key
      - PORT=5013
    depends_on:
      - postgres
      - redis
    networks:
      - tigerex-network

  # Infrastructure Services
  postgres:
    image: postgres:15
    container_name: tigerex-postgres
    environment:
      - POSTGRES_DB=tigerex
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - tigerex-network

  redis:
    image: redis:7-alpine
    container_name: tigerex-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - tigerex-network

  nginx:
    image: nginx:alpine
    container_name: tigerex-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - tiger-academy-service
      - tiger-admin-service
      - tiger-unified-exchange-service
    networks:
      - tigerex-network

  # Frontend Service
  frontend:
    build: ./frontend
    container_name: tigerex-frontend
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:80
    depends_on:
      - nginx
    networks:
      - tigerex-network

volumes:
  postgres_data:
  redis_data:

networks:
  tigerex-network:
    driver: bridge